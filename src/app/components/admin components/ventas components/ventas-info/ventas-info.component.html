<div class="container mt-4 mb-5">
  <div class="row">
    <div class="backbutton w-100">
      <h2 class="mb-4">{{ "Ventas" | uppercase }}</h2>
      <div class="example-button-container">
        <a mat-flat-button color="primary" routerLink="/adminHome">
          <mat-icon>arrow_back</mat-icon>
          Volver
        </a>
      </div>
    </div>

    <div style="margin-bottom: 16px">
      <button mat-raised-button color="primary" (click)="toggleFilter()">
        Filtrar
      </button>
    </div>

    <div *ngIf="showFilter" style="margin-bottom: 16px; width: 90vw">
      <form [formGroup]="filterForm">
        <div class="row" style="width: 100vw">
          <div class="col-lg-3 col-md-6 col-sm-11">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Fecha</mat-label>
              <input
                matInput
                [matDatepicker]="picker"
                formControlName="fecha"
              />
              <mat-datepicker-toggle
                matSuffix
                [for]="picker"
              ></mat-datepicker-toggle>
              <mat-datepicker #picker></mat-datepicker>
            </mat-form-field>
          </div>
          <div class="col-lg-3 col-md-6 col-sm-11">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Forma de Pago</mat-label>
              <mat-select formControlName="formaPago">
                <mat-option value="crédito">Crédito</mat-option>
                <mat-option value="contado">Contado</mat-option>
              </mat-select>
            </mat-form-field>
          </div>
          <div class="col-lg-3 col-md-6 col-sm-11">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Cliente</mat-label>
              <input
                matInput
                formControlName="cliente"
                placeholder="Nombre del cliente"
              />
            </mat-form-field>
          </div>
        </div>
        <div class="row" style="width: 100vw">
          <div class="col-lg-3 col-md-6 col-sm-11">
            <mat-form-field appearance="fill" class="w-100">
              <mat-label>Referencia</mat-label>
              <input
                matInput
                formControlName="referencia"
                placeholder="Referencia"
              />
            </mat-form-field>
          </div>
        </div>
        <button mat-button (click)="clearFilter()">Limpiar Filtros</button>
      </form>
    </div>

    <div class="table-responsive" style="width: 100%">
      <table mat-table [dataSource]="dataSource" class="mat-elevation-z8 table">
        <ng-container matColumnDef="fecha">
          <th mat-header-cell *matHeaderCellDef>Fecha</th>
          <td mat-cell *matCellDef="let sale">
            {{ sale.fecha | date : "dd-MM-yyyy" }}
          </td>
        </ng-container>
        <ng-container matColumnDef="cantidad">
          <th mat-header-cell *matHeaderCellDef>Cantidad</th>
          <td mat-cell *matCellDef="let sale">
            {{ totalTallasVendidas(sale.tallasVendidas) }}
          </td>
        </ng-container>
        <ng-container matColumnDef="referencia">
          <th mat-header-cell *matHeaderCellDef>Referencia</th>
          <td mat-cell *matCellDef="let sale">{{ sale.referencia }}</td>
        </ng-container>
        <ng-container matColumnDef="precio">
          <th mat-header-cell *matHeaderCellDef>Precio</th>
          <td mat-cell *matCellDef="let sale">
            {{ sale.precio | currency : "COP " : "symbol" : "1.0-0" }}
          </td>
        </ng-container>
        <ng-container matColumnDef="cliente">
          <th mat-header-cell *matHeaderCellDef>Cliente</th>
          <td mat-cell *matCellDef="let sale">{{ sale.nombreCliente }}</td>
        </ng-container>
        <ng-container matColumnDef="formaPago">
          <th mat-header-cell *matHeaderCellDef>Forma de Pago</th>
          <td mat-cell *matCellDef="let sale">{{ sale.formaPago }}</td>
        </ng-container>
        <ng-container matColumnDef="actions">
          <th mat-header-cell *matHeaderCellDef>Acción</th>
          <td mat-cell *matCellDef="let sale">
            <button mat-icon-button (click)="onViewSale(sale)">
              <mat-icon>find_in_page</mat-icon>
            </button>
          </td>
        </ng-container>
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let row; columns: displayedColumns"></tr>
      </table>
    </div>

    <mat-paginator
      class="mb-5"
      [pageSizeOptions]="[5, 10, 20]"
      showFirstLastButtons
    ></mat-paginator>
  </div>
  <!-- 
  <div class="row" style="margin-top: 20px">
    <h4>Ver ventas mensuales</h4>
    <div class="col-lg-6 col-md-6 col-sm-12">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Seleccionar Año</mat-label>
        <mat-select
          [(value)]="selectedYear"
          (selectionChange)="calculateMonthlySales()"
        >
          <mat-option *ngFor="let year of years" [value]="year">
            {{ year }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="col-lg-6 col-md-6 col-sm-12">
      <mat-form-field appearance="fill" class="w-100">
        <mat-label>Seleccionar Mes</mat-label>
        <mat-select
          [(value)]="selectedMonth"
          (selectionChange)="calculateMonthlySales()"
        >
          <mat-option *ngFor="let month of months" [value]="month.value">
            {{ month.name }}
          </mat-option>
        </mat-select>
      </mat-form-field>
    </div>
  </div> -->
  <div class="row">
    <div class="col-lg-3 col-md-6 col-sm-11">
      <button mat-stroked-button class="w-100" routerLink="/ventaxmes">
        Ver Ventas por mes
      </button>
    </div>
  </div>

  <!-- <div class="row">
    <div class="col-lg-12">
      <span style="color: white">
        Total de Ventas de {{ selectedMonthName }} {{ selectedYear }}:
        {{ totalSales | currency : "COP" : "symbol" : "1.0-0" }}
      </span>
    </div>
  </div> -->
</div>
